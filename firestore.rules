rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // Helper function to check if user is admin
    function isAdmin() {
      // TODO: Replace 'YOUR_ADMIN_UID_HERE' with actual UID from create-admin script
      // Get UID by running: npm run create-admin
      return request.auth != null && request.auth.uid == 'YOUR_ADMIN_UID_HERE';
    }

    // Jobs collection
    match /jobs/{jobId} {
      // Public can read published jobs
      allow read: if resource.data.status == 'published';
      // Admin can read all jobs (including drafts)
      allow read: if isAdmin();
      // Only admin can create/update/delete jobs
      allow write: if isAdmin();
    }

    // Applications collection
    match /applications/{applicationId} {
      // Anyone can submit application (create)
      allow create: if true;
      // Only admin can read/update/delete applications
      allow read, update, delete: if isAdmin();
    }

    // Settings collection (departments, positions, skills, etc.)
    match /settings/{settingId} {
      // Anyone can read settings (needed for dropdown values in job form)
      allow read: if true;
      // Only admin can modify settings
      allow write: if isAdmin();
    }

    // Test collection (for debugging - remove in production)
    match /test_connection/{docId} {
      allow read, write: if true;
    }

    // Deny all other collections by default
    match /{document=**} {
      allow read, write: if false;
    }
  }
}